#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ”¥ Running pre-push checks..."

# Run npm install
echo "ğŸ“¦ Installing dependencies..."
npm i
INSTALL_EXIT_CODE=$?

if [ $INSTALL_EXIT_CODE -ne 0 ]; then
  echo ""
  echo "âŒâŒâŒ NPM INSTALL FAILED WITH CODE $INSTALL_EXIT_CODE âŒâŒâŒ"
  echo "âŒâŒâŒ PUSH ABORTED âŒâŒâŒ"
  echo ""
  # Force exit with unmistakable error
  exec < /dev/null
  exit 128
fi

# Run build script
echo "ğŸ› ï¸ Building project..."
npm run build
BUILD_EXIT_CODE=$?

if [ $BUILD_EXIT_CODE -ne 0 ]; then
  echo ""
  echo "âŒâŒâŒ BUILD FAILED WITH CODE $BUILD_EXIT_CODE âŒâŒâŒ"
  echo "âŒâŒâŒ PUSH ABORTED âŒâŒâŒ"
  echo ""
  # Force exit with unmistakable error
  exec < /dev/null
  exit 128
fi
git add .
echo "âœ… All checks passed! Pushing to remote..."